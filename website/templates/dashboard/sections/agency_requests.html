{% extends "dashboard/base_dashboard.html" %}
{% block content %}

<h2 class="text-2xl font-bold mb-6">ğŸ“ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ù†Ù…Ø§ÛŒÙ†Ø¯Ú¯ÛŒ</h2>

<table class="table w-full border">
  <thead>
    <tr>
      <th>#</th>
      <th>Ù†Ø§Ù… Ú©Ø§Ù…Ù„</th>
      <th>Ø´Ù‡Ø±</th>
      <th>Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³</th>
    </tr>
  </thead>
  <tbody>
    {% for request in page_obj %}
    <tr class="cursor-pointer hover:bg-gray-100" onclick="openRequestModal({{ request.id }})">
      <td>{{ forloop.counter0|add:page_obj.start_index }}</td>
      <td>{{ request.full_name }}</td>
      <td>{{ request.city }}</td>
      <td>{{ request.phone }}</td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="4" class="text-center text-gray-500">Ù‡ÛŒÚ† Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Pagination -->
<div class="mt-4">
  {% include "dashboard/partials/pagination.html" with page_obj=page_obj %}
</div>

<!-- Modal Ø¬Ø²Ø¦ÛŒØ§Øª Ø¯Ø±Ø®ÙˆØ§Ø³Øª -->
<dialog id="requestModal" class="modal w-full max-w-2xl">
  <div class="modal-box relative">
    <h3 class="text-lg font-bold mb-4">Ø¬Ø²Ø¦ÛŒØ§Øª Ø¯Ø±Ø®ÙˆØ§Ø³Øª</h3>
    <p id="requestName" class="mb-1 font-semibold"></p>
    <p id="requestCity" class="mb-1"></p>
    <p id="requestPhone" class="mb-3"></p>
    <p id="requestCreated" class="text-gray-500"></p>

    <div class="modal-action">
      <button type="button" class="btn" onclick="closeRequestModal()">Ø¨Ø³ØªÙ†</button>
    </div>
  </div>
</dialog>

<script>
  const requestsData = {
    {% for request in page_obj %}
    "{{ request.id }}": {
      "full_name": "{{ request.full_name }}",
      "city": "{{ request.city }}",
      "phone": "{{ request.phone }}",
      "created_at": "{{ request.created_at|date:'Y/m/d H:i' }}"
    },
    {% endfor %}
  };

  function openRequestModal(requestId) {
    const data = requestsData[requestId];
    document.getElementById("requestName").innerText = `Ù†Ø§Ù… Ú©Ø§Ù…Ù„: ${data.full_name}`;
    document.getElementById("requestCity").innerText = `Ø´Ù‡Ø±: ${data.city}`;
    document.getElementById("requestPhone").innerText = `Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³: ${data.phone}`;
    document.getElementById("requestCreated").innerText = `ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª: ${data.created_at}`;

    document.getElementById("requestModal").showModal();
  }

  function closeRequestModal() {
    document.getElementById("requestModal").close();
  }
</script>

{% endblock %}