{% extends "dashboard/base_dashboard.html" %}
{% block content %}

<div class="flex justify-between items-center mb-6">
  <h2 class="text-2xl font-bold">ğŸ“‚ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</h2>
  <a href="{% url 'dashboard_category_add' %}" class="btn btn-primary">â• Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</a>
</div>

<table class="table w-full border">
  <thead>
    <tr>
      <th>#</th>
      <th>Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</th>
      <th>Ù†Ø§Ù…Ú© (Slug)</th>
      <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
    </tr>
  </thead>
  <tbody>
    {% for category in page_obj %}
    <tr>
      <td>{{ forloop.counter0|add:page_obj.start_index }}</td>
      <td>{{ category.name }}</td>
      <td>{{ category.slug }}</td>
      <td class="flex gap-2">
        <a href="{% url 'dashboard_category_edit' category.id %}" class="btn btn-sm btn-warning">ÙˆÛŒØ±Ø§ÛŒØ´</a>
        <button onclick="openDeleteCategoryModal('{{ category.id }}', '{{ category.name }}')" class="btn btn-sm btn-error">Ø­Ø°Ù</button>
      </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="4" class="text-center text-gray-500">Ù‡ÛŒÚ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Pagination -->
<div class="mt-4">
  {% include "dashboard/partials/pagination.html" with page_obj=page_obj %}
</div>

<!-- Modal Ø­Ø°Ù Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ -->
<dialog id="deleteCategoryModal" class="modal">
  <div class="modal-box">
    <h3 class="font-bold text-lg text-error">âš ï¸ ØªØ£ÛŒÛŒØ¯ Ø­Ø°Ù</h3>
    <p class="py-4" id="deleteCategoryMessage">Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ</p>

    <div class="modal-action">
      <form method="post" id="deleteCategoryForm">
        {% csrf_token %}
        <button type="submit" class="btn btn-error">Ø¨Ù„Ù‡ØŒ Ø­Ø°Ù Ø´ÙˆØ¯</button>
      </form>
      <button type="button" class="btn" onclick="closeDeleteCategoryModal()">Ø§Ù†ØµØ±Ø§Ù</button>
    </div>
  </div>
</dialog>

<script>
  function openDeleteCategoryModal(id, name) {
    const modal = document.getElementById("deleteCategoryModal");
    const form = document.getElementById("deleteCategoryForm");
    const msg = document.getElementById("deleteCategoryMessage");

    msg.innerHTML = `Ø´Ù…Ø§ Ø¯Ø± Ø­Ø§Ù„ Ø­Ø°Ù Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ <b class="text-error">Â«${name}Â»</b> Ù‡Ø³ØªÛŒØ¯. Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`;
    form.action = `/dashboard/categories/delete/${id}/`;
    modal.showModal();
  }

  function closeDeleteCategoryModal() {
    document.getElementById("deleteCategoryModal").close();
  }
</script>

{% endblock %}