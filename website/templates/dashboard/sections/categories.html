{% extends "dashboard/base_dashboard.html" %}
{% block content %}
<div class="flex items-center justify-between mb-6">
  <h1 class="text-2xl font-bold">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M4 3C3.44772 3 3 3.44772 3 4V20C3 20.5523 3.44772 21 4 21H14C14.5523 21 15 20.5523 15 20V15.2973L15.9995 19.9996C16.1143 20.5398 16.6454 20.8847 17.1856 20.7699L21.0982 19.9382C21.6384 19.8234 21.9832 19.2924 21.8684 18.7522L18.9576 5.0581C18.8428 4.51788 18.3118 4.17304 17.7716 4.28786L14.9927 4.87853C14.9328 4.38353 14.5112 4 14 4H10C10 3.44772 9.55228 3 9 3H4ZM10 6H13V14H10V6ZM10 19V16H13V19H10ZM8 5V15H5V5H8ZM8 17V19H5V17H8ZM17.3321 16.6496L19.2884 16.2338L19.7042 18.1898L17.7479 18.6057L17.3321 16.6496ZM16.9163 14.6933L15.253 6.86789L17.2092 6.45207L18.8726 14.2775L16.9163 14.6933Z"></path></svg>
   دسته‌بندی‌ها
  </h1>
  <a href="{% url 'dashboard_category_add' %}" class="btn bg-[#e66700] text-[#fff]">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M4 1V4H1V6H4V9H6V6H9V4H6V1H4ZM3 20.0066V11H5V19H13V14C13 13.45 13.45 13 14 13L19 12.999V5H11V3H20.0066C20.5552 3 21 3.45576 21 4.00247V15L15 20.996L4.00221 21C3.4487 21 3 20.5551 3 20.0066ZM18.171 14.999L15 15V18.169L18.171 14.999Z"></path></svg>
    افزودن دسته‌بندی
  </a>
</div>

<div class="overflow-x-auto bg-base-100 shadow rounded-xl">
  <table class="table">
    <thead>
      <tr>
        <th>ردیف</th>
        <th>نام دسته‌بندی</th>
        <th>نامک (Slug)</th>
        <th>عملیات</th>
      </tr>
    </thead>
    <tbody>
      {% for category in page_obj %}
      <tr>
        <td>{{ forloop.counter0|add:page_obj.start_index }}</td>
        <td>{{ category.name }}</td>
        <td>{{ category.slug }}</td>
        <td class="flex gap-2">
          <a href="{% url 'dashboard_category_edit' category.id %}" class="btn btn-sm btn-warning">ویرایش</a>
          <button onclick="openDeleteCategoryModal('{{ category.id }}', '{{ category.name }}')" class="btn btn-sm btn-error">حذف</button>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="4" class="text-center text-gray-500">هیچ دسته‌بندی ثبت نشده است.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Pagination -->
<div class="mt-6 flex justify-center">
  {% include "dashboard/partials/pagination.html" with page_obj=page_obj %}
</div>

<!-- Modal حذف دسته‌بندی -->
<dialog id="deleteCategoryModal" class="modal">
  <div class="modal-box">
    <h3 class="font-bold text-lg text-error">⚠️ تأیید حذف</h3>
    <p class="py-4" id="deleteCategoryMessage">آیا از حذف این دسته‌بندی مطمئن هستید؟</p>

    <div class="modal-action">
      <form method="post" id="deleteCategoryForm">
        {% csrf_token %}
        <button type="submit" class="btn btn-error">بله، حذف شود</button>
      </form>
      <button type="button" class="btn" onclick="closeDeleteCategoryModal()">انصراف</button>
    </div>
  </div>
</dialog>

<script>
  function openDeleteCategoryModal(id, name) {
    const modal = document.getElementById("deleteCategoryModal");
    const form = document.getElementById("deleteCategoryForm");
    const msg = document.getElementById("deleteCategoryMessage");

    msg.innerHTML = `شما در حال حذف دسته‌بندی <b class="text-error">«${name}»</b> هستید. آیا مطمئن هستید؟`;
    form.action = `/dashboard/categories/delete/${id}/`;
    modal.showModal();
  }

  function closeDeleteCategoryModal() {
    document.getElementById("deleteCategoryModal").close();
  }
</script>

{% endblock %}