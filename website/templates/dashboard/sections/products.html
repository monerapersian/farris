{% extends 'dashboard/base_dashboard.html' %}
{% load humanize %}
{% block title %}Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø­ØµÙˆÙ„Ø§Øª{% endblock %}

{% block content %}
<div class="flex items-center justify-between mb-6">
  <h1 class="text-2xl font-bold">ğŸ“¦ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø­ØµÙˆÙ„Ø§Øª</h1>
  <a href="{% url 'dashboard_product_add' %}" class="btn btn-primary">Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯</a>
</div>

<div class="overflow-x-auto bg-base-100 shadow rounded-xl">
  <table class="table">
    <thead>
      <tr>
        <th>Ø±Ø¯ÛŒÙ</th>
        <th>Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„</th>
        <th>Ù‚ÛŒÙ…Øª</th>
        <th>Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</th>
        <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
      </tr>
    </thead>
    <tbody>
      {% for product in products %}
      <tr>
        <td>{{ forloop.counter|add:page_obj.start_index|add:"-1" }}</td>
        <td>{{ product.title }}</td>
        <td>{{ product.price|intcomma }} ØªÙˆÙ…Ø§Ù†</td>
        <td>{{ product.category }}</td>
        <td>
          <a href="{% url 'dashboard_product_edit' product.id %}" class="btn btn-sm btn-info">ÙˆÛŒØ±Ø§ÛŒØ´</a>
          <button onclick="openDeleteModal('{{ product.id }}', '{{ product.title }}')" class="btn btn-sm btn-error">Ø­Ø°Ù</button>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="5" class="text-center py-4 text-gray-500">Ù…Ø­ØµÙˆÙ„ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div class="mt-6 flex justify-center">
  {% include 'dashboard/partials/pagination.html' %}
</div>

<!-- Modal ØªØ£ÛŒÛŒØ¯ Ø­Ø°Ù -->
<dialog id="deleteModal" class="modal">
  <div class="modal-box">
    <h3 class="font-bold text-lg text-error">âš ï¸ ØªØ£ÛŒÛŒØ¯ Ø­Ø°Ù</h3>
    <p class="py-4" id="deleteMessage">Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ù…ÙˆØ±Ø¯ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ</p>

    <div class="modal-action">
      <form method="post" id="deleteForm">
        {% csrf_token %}
        <button type="submit" class="btn btn-error">Ø¨Ù„Ù‡ØŒ Ø­Ø°Ù Ø´ÙˆØ¯</button>
      </form>
      <button type="button" class="btn" onclick="closeDeleteModal()">Ø§Ù†ØµØ±Ø§Ù</button>
    </div>
  </div>
</dialog>

<script>
  function openDeleteModal(productId, productTitle) {
    const modal = document.getElementById("deleteModal");
    const form = document.getElementById("deleteForm");
    const msg = document.getElementById("deleteMessage");

    // ØªÙ†Ø¸ÛŒÙ… Ù¾ÛŒØ§Ù… Ø¯Ø§Ø®Ù„ Ù…ÙˆØ¯Ø§Ù„
    msg.innerHTML = `Ø´Ù…Ø§ Ø¯Ø± Ø­Ø§Ù„ Ø­Ø°Ù Ù…Ø­ØµÙˆÙ„ <b class="text-error">Â«${productTitle}Â»</b> Ù‡Ø³ØªÛŒØ¯. Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ØŸ`;

    // ØªÙ†Ø¸ÛŒÙ… Ø¢Ø¯Ø±Ø³ Ø§Ú©Ø´Ù† ÙØ±Ù…
    form.action = `/dashboard/products/delete/${productId}/`;

    // Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…ÙˆØ¯Ø§Ù„
    modal.showModal();
  }

  function closeDeleteModal() {
    document.getElementById("deleteModal").close();
  }
</script>

<script>
function confirmDelete(name) {
  if (confirm(`Ø´Ù…Ø§ Ø¯Ø± Ø­Ø§Ù„ Ø­Ø°Ù ${name} Ù‡Ø³ØªÛŒØ¯. Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ØŸ`)) {
    // Ø§ÛŒÙ†Ø¬Ø§ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø­Ø°Ù Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒØ´Ù‡
  }
}
</script>
{% endblock %}