<div class="flex justify-between items-center mb-4">
  <h2 class="text-xl font-bold">Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø­ØµÙˆÙ„Ø§Øª</h2>
  <button class="btn btn-primary" onclick="openProductModal()">â• Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯</button>
</div>

<table class="table w-full">
  <thead>
    <tr>
      <th>#</th>
      <th>Ø¹Ù†ÙˆØ§Ù†</th>
      <th>Ù‚ÛŒÙ…Øª</th>
      <th>Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</th>
      <th>ØªØ§Ø±ÛŒØ®</th>
      <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
    </tr>
  </thead>
  <tbody>
    {% for product in products %}
    <tr>
      <td>{{ forloop.counter }}</td>
      <td>{{ product.title }}</td>
      <td>{{ product.price|floatformat:0 }} ØªÙˆÙ…Ø§Ù†</td>
      <td>{{ product.category.title }}</td>
      <td>{{ product.created_at|date:"Y-m-d" }}</td>
      <td>
        <button class="btn btn-xs btn-info" onclick="editProduct({{ product.id }}, '{{ product.title }}', '{{ product.price }}')">ÙˆÛŒØ±Ø§ÛŒØ´</button>
        <button class="btn btn-xs btn-error" onclick="deleteProduct({{ product.id }}, '{{ product.title }}')">Ø­Ø°Ù</button>
      </td>
    </tr>
    {% empty %}
    <tr><td colspan="6" class="text-center">Ù‡ÛŒÚ† Ù…Ø­ØµÙˆÙ„ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</td></tr>
    {% endfor %}
  </tbody>
</table>

<div class="mt-4 flex justify-center">
  {% if page_obj.has_previous %}
    <button class="btn btn-sm" onclick="loadSection('products?page={{ page_obj.previous_page_number }}')">Ù‚Ø¨Ù„ÛŒ</button>
  {% endif %}
  <span class="mx-2">ØµÙØ­Ù‡ {{ page_obj.number }} Ø§Ø² {{ page_obj.paginator.num_pages }}</span>
  {% if page_obj.has_next %}
    <button class="btn btn-sm" onclick="loadSection('products?page={{ page_obj.next_page_number }}')">Ø¨Ø¹Ø¯ÛŒ</button>
  {% endif %}
</div>

<!-- Modal -->
<dialog id="productModal" class="modal">
  <form method="dialog" class="modal-box">
    <h3 id="modalTitle" class="font-bold text-lg">Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯</h3>
    <input type="hidden" id="productId">
    <div class="py-2">
      <input id="title" class="input input-bordered w-full" placeholder="Ø¹Ù†ÙˆØ§Ù† Ù…Ø­ØµÙˆÙ„">
    </div>
    <div class="py-2">
      <input id="slug" class="input input-bordered w-full" placeholder="slug Ù…Ø­ØµÙˆÙ„">
    </div>
    <div class="py-2">
      <input id="price" class="input input-bordered w-full" placeholder="Ù‚ÛŒÙ…Øª (ØªÙˆÙ…Ø§Ù†)">
    </div>
    <div class="py-2">
      <textarea id="description" class="textarea textarea-bordered w-full" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª"></textarea>
    </div>
    <div class="modal-action">
      <button type="button" class="btn" onclick="saveProduct()">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡</button>
      <button class="btn">Ø¨Ø³ØªÙ†</button>
    </div>
  </form>
</dialog>

<script>
function openProductModal() {
  document.getElementById("modalTitle").innerText = "Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯";
  document.getElementById("productId").value = "";
  document.getElementById("title").value = "";
  document.getElementById("slug").value = "";
  document.getElementById("price").value = "";
  document.getElementById("description").value = "";
  document.getElementById("productModal").showModal();
}

function editProduct(id, title, price) {
  document.getElementById("modalTitle").innerText = "ÙˆÛŒØ±Ø§ÛŒØ´ Ù…Ø­ØµÙˆÙ„";
  document.getElementById("productId").value = id;
  document.getElementById("title").value = title;
  document.getElementById("price").value = price;
  document.getElementById("productModal").showModal();
}

function saveProduct() {
  const id = document.getElementById("productId").value;
  const url = id ? "/dashboard/products/update/" : "/dashboard/products/create/";
  const formData = new FormData();
  formData.append("product_id", id);
  formData.append("title", document.getElementById("title").value);
  formData.append("slug", document.getElementById("slug").value);
  formData.append("price", document.getElementById("price").value);
  formData.append("description", document.getElementById("description").value);

  axios.post(url, formData).then(res => {
    if (res.data.success) {
      document.getElementById("productModal").close();
      loadSection('products');
    }
  });
}

function deleteProduct(id, title) {
  if (!confirm(`Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù "${title}" Ù…Ø·Ù…Ø¦Ù†ÛŒØŸ`)) return;
  axios.post(`/dashboard/products/delete/${id}/`).then(res => {
    if (res.data.success) loadSection('products');
  });
}
</script>