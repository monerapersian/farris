{% extends "dashboard/base_dashboard.html" %}


{% block content %}
<div class="flex items-center justify-between mb-6">
  <h1 class="flex gap-2 text-2xl font-bold">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M5.00488 9.00268C5.55717 9.00268 6.00488 9.45039 6.00488 10.0027C7.63965 10.0027 9.14352 10.5631 10.3349 11.5022L12.5049 11.5027C13.837 11.5027 15.0339 12.0815 15.8579 13.0014L19.0049 13.0027C20.9972 13.0027 22.7173 14.1679 23.521 15.8541C21.1562 18.9747 17.3268 21.0027 13.0049 21.0027C10.2142 21.0027 7.85466 20.3994 5.944 19.3447C5.80557 19.7283 5.43727 20.0027 5.00488 20.0027H2.00488C1.4526 20.0027 1.00488 19.555 1.00488 19.0027V10.0027C1.00488 9.45039 1.4526 9.00268 2.00488 9.00268H5.00488ZM6.00589 12.0027L6.00488 17.0238L6.05024 17.0572C7.84406 18.3176 10.183 19.0027 13.0049 19.0027C16.0089 19.0027 18.8035 17.847 20.84 15.8732L20.9729 15.7397L20.8537 15.6393C20.3897 15.2763 19.8205 15.051 19.2099 15.0096L19.0049 15.0027L16.8932 15.0017C16.9663 15.3236 17.0049 15.6586 17.0049 16.0027V17.0027H8.00488V15.0027L14.7949 15.0017L14.7605 14.9232C14.38 14.1296 13.593 13.568 12.6693 13.508L12.5049 13.5027L9.57547 13.5025C8.66823 12.5772 7.40412 12.003 6.00589 12.0027ZM4.00488 11.0027H3.00488V18.0027H4.00488V11.0027ZM13.6513 3.57806L14.0046 3.93183L14.3584 3.57806C15.3347 2.60175 16.9177 2.60175 17.894 3.57806C18.8703 4.55437 18.8703 6.13728 17.894 7.11359L14.0049 11.0027L10.1158 7.11359C9.13948 6.13728 9.13948 4.55437 10.1158 3.57806C11.0921 2.60175 12.675 2.60175 13.6513 3.57806ZM11.53 4.99227C11.3564 5.16584 11.3372 5.43526 11.4714 5.62938L11.5289 5.69831L14.0039 8.17368L16.4798 5.69938C16.6533 5.52581 16.6726 5.25639 16.5376 5.06152L16.4798 4.99227C16.3062 4.81871 16.0368 4.79942 15.8417 4.93457L15.7724 4.99249L14.0033 6.76111L12.236 4.9912L12.1679 4.93442C11.973 4.79942 11.7036 4.81871 11.53 4.99227Z"></path></svg>
    آموزش‌ها
  </h1>
  <a href="{% url 'dashboard_course_add' %}" class="btn bg-[#e66700] text-[#fff]">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M4 1V4H1V6H4V9H6V6H9V4H6V1H4ZM3 20.0066V11H5V19H13V14C13 13.45 13.45 13 14 13L19 12.999V5H11V3H20.0066C20.5552 3 21 3.45576 21 4.00247V15L15 20.996L4.00221 21C3.4487 21 3 20.5551 3 20.0066ZM18.171 14.999L15 15V18.169L18.171 14.999Z"></path></svg>
    افزودن آموزش
  </a>
</div>

<table class="table">
  <thead>
    <tr>
      <th>ردیف</th>
      <th>عنوان</th>
      <th>ویژه</th>
      <!-- <th>تاریخ ایجاد</th> -->
      <th>عملیات</th>
    </tr>
  </thead>
  <tbody>
    {% for course in page_obj %}
    <tr>
      <td>{{ forloop.counter0|add:page_obj.start_index }}</td>
      <td class="whitespace-nowrap">{{ course.title }}</td>
      <td>{% if course.special %}✅{% else %}❌{% endif %}</td>
      <!-- <td>{{ course.created_at|date:"Y/m/d H:i" }}</td> -->
      <td class="flex gap-2">
        <a href="{% url 'dashboard_course_edit' course.id %}" class="btn btn-sm btn-warning">ویرایش</a>
        <button onclick="openDeleteCourseModal('{{ course.id }}', '{{ course.title }}')" class="btn btn-sm btn-error">حذف</button>
      </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="5" class="text-center text-gray-500">هیچ آموزشی ثبت نشده است.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Pagination -->
<div class="mt-4">
  {% include "dashboard/partials/pagination.html" with page_obj=page_obj %}
</div>

<!-- Modal حذف آموزش -->
<dialog id="deleteCourseModal" class="modal">
  <div class="modal-box">
    <h3 class="font-bold text-lg text-error">⚠️ تأیید حذف</h3>
    <p class="py-4" id="deleteCourseMessage">آیا از حذف این آموزش مطمئن هستید؟</p>

    <div class="modal-action">
      <form method="post" id="deleteCourseForm">
        {% csrf_token %}
        <button type="submit" class="btn btn-error">بله، حذف شود</button>
      </form>
      <button type="button" class="btn" onclick="closeDeleteCourseModal()">انصراف</button>
    </div>
  </div>
</dialog>

<script>
  function openDeleteCourseModal(id, title) {
    const modal = document.getElementById("deleteCourseModal");
    const form = document.getElementById("deleteCourseForm");
    const msg = document.getElementById("deleteCourseMessage");

    msg.innerHTML = `شما در حال حذف آموزش <b class="text-error">«${title}»</b> هستید. آیا مطمئن هستید؟`;
    form.action = `/dashboard/courses/delete/${id}/`;
    modal.showModal();
  }

  function closeDeleteCourseModal() {
    document.getElementById("deleteCourseModal").close();
  }
</script>

{% endblock %}