{% extends "dashboard/base_dashboard.html" %}
{% block content %}

<div class="flex justify-between items-center mb-6">
  <h2 class="text-2xl font-bold">ğŸ“° Ù…Ù‚Ø§Ù„Ø§Øª</h2>
  <a href="{% url 'dashboard_article_add' %}" class="btn btn-primary">â• Ø§ÙØ²ÙˆØ¯Ù† Ù…Ù‚Ø§Ù„Ù‡</a>
</div>

<table class="table w-full border">
  <thead>
    <tr>
      <th>#</th>
      <th>Ø¹Ù†ÙˆØ§Ù†</th>
      <th>ÙˆÛŒÚ˜Ù‡</th>
      <th>ØªØ§Ø±ÛŒØ® Ø§ÛŒØ¬Ø§Ø¯</th>
      <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
    </tr>
  </thead>
  <tbody>
    {% for article in page_obj %}
    <tr>
      <td>{{ forloop.counter0|add:page_obj.start_index }}</td>
      <td>{{ article.title }}</td>
      <td>{% if article.special %}âœ…{% else %}âŒ{% endif %}</td>
      <td>{{ article.created_at|date:"Y/m/d H:i" }}</td>
      <td class="flex gap-2">
        <a href="{% url 'dashboard_article_edit' article.id %}" class="btn btn-sm btn-warning">ÙˆÛŒØ±Ø§ÛŒØ´</a>
        <button onclick="openDeleteArticleModal('{{ article.id }}', '{{ article.title }}')" class="btn btn-sm btn-error">Ø­Ø°Ù</button>
      </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="5" class="text-center text-gray-500">Ù‡ÛŒÚ† Ù…Ù‚Ø§Ù„Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Pagination -->
<div class="mt-4">
  {% include "dashboard/partials/pagination.html" with page_obj=page_obj %}
</div>

<!-- Modal Ø­Ø°Ù Ù…Ù‚Ø§Ù„Ù‡ -->
<dialog id="deleteArticleModal" class="modal">
  <div class="modal-box">
    <h3 class="font-bold text-lg text-error">âš ï¸ ØªØ£ÛŒÛŒØ¯ Ø­Ø°Ù</h3>
    <p class="py-4" id="deleteArticleMessage">Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ù…Ù‚Ø§Ù„Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ</p>

    <div class="modal-action">
      <form method="post" id="deleteArticleForm">
        {% csrf_token %}
        <button type="submit" class="btn btn-error">Ø¨Ù„Ù‡ØŒ Ø­Ø°Ù Ø´ÙˆØ¯</button>
      </form>
      <button type="button" class="btn" onclick="closeDeleteArticleModal()">Ø§Ù†ØµØ±Ø§Ù</button>
    </div>
  </div>
</dialog>

<script>
  function openDeleteArticleModal(id, title) {
    const modal = document.getElementById("deleteArticleModal");
    const form = document.getElementById("deleteArticleForm");
    const msg = document.getElementById("deleteArticleMessage");

    msg.innerHTML = `Ø´Ù…Ø§ Ø¯Ø± Ø­Ø§Ù„ Ø­Ø°Ù Ù…Ù‚Ø§Ù„Ù‡ <b class="text-error">Â«${title}Â»</b> Ù‡Ø³ØªÛŒØ¯. Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`;
    form.action = `/dashboard/articles/delete/${id}/`;
    modal.showModal();
  }

  function closeDeleteArticleModal() {
    document.getElementById("deleteArticleModal").close();
  }
</script>

{% endblock %}